<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>MathGloss</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 20px;
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
            }
            .controls {
                margin-bottom: 20px;
                padding: 10px;
                background: #f5f5f5;
                border-radius: 4px;
            }
            table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 20px;
            }
            th, td {
                border: 1px solid #ddd;
                padding: 8px;
                text-align: left;
            }
            th {
                background-color: #f8f9fa;
                cursor: pointer;
                position: relative;
                padding-right: 20px;
            }
            th:hover {
                background-color: #e9ecef;
            }
            th::after {
                content: '⇕';
                position: absolute;
                right: 8px;
                opacity: 0.5;
            }
            th.asc::after {
                content: '↑';
                opacity: 1;
            }
            th.desc::after {
                content: '↓';
                opacity: 1;
            }
            th .source-link {
                color: inherit;
                text-decoration: none;
                border-bottom: 1px dotted #666;
                display: inline-block;
                margin-right: 15px; /* Space for sort indicator */
            }
            th .source-link:hover {
                border-bottom-style: solid;
            }
            tr:nth-child(even) {
                background-color: #f9f9f9;
            }
            .source-toggle {
                margin-right: 15px;
            }
            .loading {
                display: none;
                margin: 20px 0;
            }
            .wikidata-id {
                color: #666;
                font-size: 0.9em;
            }
        </style>
    </head>
<body>
    <h1>MathGloss</h1>
    <div id="toggle-buttons"></div>
    <table id="glossary-table" class="tablesorter">
        <thead>
            <tr id="table-headers"></tr>
        </thead>
        <tbody id="table-body"></tbody>
    </table>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.31.3/js/jquery.tablesorter.min.js"></script>
    <script>
        $(document).ready(function() {
            const csvFilePath = 'path/to/your/csvfile.csv'; // Update with the path to your CSV file

            $.get(csvFilePath, function(data) {
                const rows = data.split('\n');
                const headers = rows[0].split(',');

                // Create table headers
                headers.forEach((header, index) => {
                    const th = $('<th></th>');
                    const headerLink = $('<a></a>').attr('href', `source_info_${index}.html`).text(header);
                    th.append(headerLink);
                    th.append(`
                        <button class="toggle-column" data-column="${index}">Toggle</button>
                    `);
                    th.on('click', () => sortTable(index));
                    $('#table-headers').append(th);
                });

                // Create table rows
                rows.slice(1).forEach(row => {
                    const columns = row.split(',');
                    const tableRow = $('<tr></tr>');
                    columns.forEach((column, index) => {
                        const td = $('<td></td>');
                        const markdownLink = column.match(/\[(.*?)\]\((.*?)\)/);
                        if (markdownLink) {
                            const a = $('<a></a>').attr('href', markdownLink[2]).text(markdownLink[1]).attr('target', '_blank');
                            td.append(a);
                        } else {
                            td.text(column);
                        }
                        tableRow.append(td);
                    });
                    $('#table-body').append(tableRow);
                });

                // Initialize tablesorter
                $("#glossary-table").tablesorter();

                // Toggle column visibility
                $('.toggle-column').on('click', function() {
                    const column = $(this).data('column');
                    const isChecked = $(this).is(':checked');
                    $(`#glossary-table tr th:nth-child(${column + 1}), #glossary-table tr td:nth-child(${column + 1})`).toggle(isChecked);
                });
            });

            function sortTable(columnIndex) {
                const table = document.getElementById('glossary-table');
                const tbody = table.querySelector('tbody');
                const rows = Array.from(tbody.rows);

                const sortedRows = rows.sort((a, b) => {
                    const aText = a.cells[columnIndex].textContent.trim();
                    const bText = b.cells[columnIndex].textContent.trim();
                    return aText.localeCompare(bText);
                });

                tbody.innerHTML = '';
                sortedRows.forEach(row => tbody.appendChild(row));
            }
        });
    </script>
</body>
</html>